<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¼¢å­—ã®å­¦ç¿’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700;900&display=swap');
        
        html, body { 
            font-family: 'Zen Maru Gothic', sans-serif; 
            background-color: #e0f2fe; 
            height: 100dvh; 
            margin: 0; 
            overflow: hidden; 
            display: flex; 
            align-items: center; 
            justify-content: center;
        }
        
        /* ç”»é¢ã‹ã‚‰ã¯ã¿å‡ºã•ãšã€ã‹ã¤ç´°é•·ããªã‚Šã™ããªã„é­”æ³•ã®ã‚³ãƒ³ãƒ†ãƒŠ */
        .app-container { 
            width: 95vw;
            height: 95dvh;
            /* ç¸¦ãŒé•·ã„ç”»é¢ã§ã‚‚æ¨ªå¹…ãŒåºƒãŒã‚Šã™ããšã€ã‹ã¤ç´°é•·ã™ããªã„æ¯”ç‡ã‚’ç¶­æŒ */
            max-width: min(600px, 90vw); 
            max-height: 900px;
            display: flex; 
            flex-direction: column; 
            background: white; 
            border: clamp(4px, 1vh, 8px) solid #6366f1; 
            border-radius: 2rem; 
            overflow: hidden;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .header { background: #6366f1; padding: 1vh; text-align: center; color: white; flex-shrink: 0; }
        .header p { font-size: clamp(1rem, 3vh, 1.8rem); font-weight: 900; }

        .timer-zone { 
            width: 100%; display: flex; align-items: center; 
            background: #1e293b; padding: 0.8vh 12px; gap: 10px; 
            border-bottom: 3px solid #475569; flex-shrink: 0;
        }
        
        .clock-face { 
            position: relative; width: 40px; height: 40px; background: white; 
            border: 2px solid #64748b; border-radius: 50%; flex-shrink: 0;
        }
        .clock-face::before { content: '12'; position: absolute; top: 1px; left: 50%; transform: translateX(-50%); font-size: 6px; font-weight: 900; color: #334155; }
        .clock-face::after { content: '6'; position: absolute; bottom: 1px; left: 50%; transform: translateX(-50%); font-size: 6px; font-weight: 900; color: #334155; }
        #clock-hand { position: absolute; bottom: 50%; left: 50%; width: 2.5px; height: 15px; background: #ef4444; transform-origin: bottom center; border-radius: 10px; }

        #timer-container { flex: 1; height: 10px; background: #334155; border-radius: 5px; overflow: hidden; }
        #timer-bar { width: 100%; height: 100%; background: #ef4444; }
        #digital-timer { font-family: monospace; font-size: clamp(0.9rem, 2.5vh, 1.2rem); font-weight: 900; color: #22c55e; background: #000; padding: 1px 6px; border-radius: 4px; min-width: 60px; text-align: center; }

        .content-area { flex: 1; position: relative; overflow: hidden; }
        
        #menu { 
            position: absolute; inset: 0; background: #f0f9ff; 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            padding: 2vh; gap: 2vh; z-index: 10;
        }
        .menu-btn { width: 90%; padding: 2.5vh; background: white; border: 4px solid; border-radius: 1.2rem; font-size: clamp(1rem, 2.5vh, 1.5rem); font-weight: 900; }

        #quiz { 
            position: absolute; inset: 0; background: #fffcf0; 
            display: none; flex-direction: column; padding: 1.5vh 15px; z-index: 20;
        }

        #question-text { 
            font-size: clamp(1rem, 3vh, 1.5rem); font-weight: 800; color: #374151; 
            padding: 1.5vh; background: white; border-radius: 1rem; border: 2px solid #e0e7ff; 
            text-align: center; margin-bottom: 1vh; flex-shrink: 0;
        }

        .fusen { 
            background-color: #fef08a; border-left: 5px solid #facc15; 
            padding: 1vh 12px; border-radius: 8px; margin-bottom: 1vh; cursor: pointer; flex-shrink: 0;
        }
        .hidden-text { filter: blur(5px); }
        .visible-text { filter: blur(0) !important; }

        .choices-grid { flex: 1; display: flex; flex-direction: column; justify-content: space-evenly; gap: 1vh; min-height: 0; }
        .choice-btn { 
            width: 100%; padding: 1.5vh; background: white; border: 3px solid #6366f1; 
            border-radius: 1rem; font-size: clamp(1.1rem, 3.5vh, 1.8rem); font-weight: 900; 
            color: #4338ca; box-shadow: 0 4px 0 #6366f1; transition: all 0.1s;
        }
        .choice-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #6366f1; }

        .bgm-toggle { position: absolute; top: 8px; right: 8px; z-index: 100; background: white; border: 2px solid #6366f1; padding: 2px 8px; border-radius: 999px; font-size: 10px; font-weight: bold; }
    </style>
</head>
<body>

<audio id="bgm" loop></audio>

<div id="feedback-overlay" class="fixed inset-0 flex items-center justify-center bg-black/75 z-[200] hidden p-4">
    <div class="bg-white p-5 rounded-[2rem] border-6 border-indigo-400 w-full max-w-[400px] text-center shadow-2xl overflow-y-auto max-h-[85vh]">
        <div id="feedback-icon" class="text-5xl mb-2"></div>
        <div class="text-left space-y-2 mb-4">
            <div class="bg-indigo-600 text-white p-2 rounded-xl text-center font-black text-xl">æ­£è§£ï¼š<span id="correct-ans"></span></div>
            <p class="text-sm font-bold text-gray-700" id="exp-text"></p>
        </div>
        <button onclick="nextQuestion()" class="w-full bg-indigo-600 text-white py-3 rounded-xl font-black text-lg">ã¤ãã¸ï¼ ğŸš€</button>
    </div>
</div>

<div class="app-container">
    <button onclick="toggleBGM()" class="bgm-toggle shadow-md" id="bgm-btn">ğŸµ BGM: ON</button>

    <div class="header"><p>æ¼¢å­—ã®å­¦ç¿’ï¼šå®—ã¡ã‚ƒã‚“</p></div>

    <div class="timer-zone">
        <div class="clock-face"><div id="clock-hand"></div></div>
        <div id="timer-container"><div id="timer-bar"></div></div>
        <div id="digital-timer">20.0</div>
    </div>

    <div class="content-area">
        <div id="menu">
            <div class="text-5xl mb-2">ğŸ¦• ğŸš€ ğŸ¯</div>
            <button onclick="startQuiz(0)" class="menu-btn border-orange-400 text-orange-600">ä¸€ï¼šåŸºæœ¬ã®æ¼¢å­— ğŸ</button>
            <button onclick="startQuiz(1)" class="menu-btn border-blue-400 text-blue-600">äºŒï¼šè©•è«–ã®æ¼¢å­— ğŸ“˜</button>
            <button onclick="startQuiz(2)" class="menu-btn border-teal-400 text-teal-600">ä¸‰ï¼šé‡è¦ãªæ¼¢å­— ğŸ’</button>
        </div>

        <div id="quiz">
            <div class="flex justify-between items-center mb-1 flex-shrink-0">
                <span id="q-count" class="text-indigo-600 font-black bg-white px-3 py-0.5 rounded-full border-2 border-indigo-200 text-xs">1 / 5</span>
                <div class="text-4xl">ğŸ§</div>
            </div>
            <div id="question-text"></div>
            <div onclick="revealMeaning()" class="fusen">
                <span class="text-yellow-700 font-black text-[10px] block">ğŸ’¡ ãƒ’ãƒ³ãƒˆï¼ˆã‚¯ãƒªãƒƒã‚¯ï¼ï¼‰</span>
                <div id="meaning-text" class="hidden-text font-bold text-gray-800 text-sm"></div>
            </div>
            <div id="choices" class="choices-grid"></div>
        </div>

        <div id="result" class="hidden absolute inset-0 bg-white flex flex-col justify-center items-center text-center p-6 z-30">
            <div class="text-7xl mb-4">ğŸ†</div>
            <h2 id="result-title" class="text-4xl font-black text-indigo-600 mb-6"></h2>
            <button onclick="location.reload()" class="w-2/3 bg-indigo-600 text-white font-black py-4 rounded-2xl text-xl shadow-lg">æˆ»ã‚‹ ğŸ </button>
        </div>
    </div>
</div>

<script>
    const musicFiles = ["126_BPM142.mp3", "128_BPM124.mp3", "233_BPM163.mp3", "275_BPM120.mp3", "416_BPM128.mp3", "447_BPM100.mp3"];
    const QUIZ_DATA = [
        [
            { s: "å®Ÿé¨“ã¯èª°ãŒã‚„ã£ã¦ã‚‚åŒã˜ã«ãªã‚‹ã€‚ã“ã®ã€Œãƒ•ãƒ˜ãƒ³ã€çš„ãªæ³•å‰‡ãŒç§‘å­¦ã ã€‚", h: "ã„ã¤ã§ã‚‚èª°ã«ã§ã‚‚ã‚ã¦ã¯ã¾ã‚‹ã“ã¨ã€‚", a: "æ™®é", c: ["æ™®é", "ä¸å¤‰", "ä¸å", "å¸ƒç‰‡"], ex: "å…¨ã¦ã®ã‚‚ã®ã«å…±é€šã—ã¦ã‚ã¦ã¯ã¾ã‚‹ã“ã¨ã€‚" },
            { s: "ã•ã£ãã¨è¨€ã£ã¦ã„ã‚‹ã“ã¨ãŒé•ã†ã‚ˆã€‚ã€Œãƒ ã‚¸ãƒ¥ãƒ³ã€ã—ã¦ã„ã‚‹ã­ã€‚", h: "è©±ã®ã¤ã˜ã¤ã¾ãŒåˆã‚ãªã„ã“ã¨ã€‚", a: "çŸ›ç›¾", c: ["çŸ›ç›¾", "ç„¡é †", "çŸ›é †", "å¤¢ç›¾"], ex: "ã¤ã˜ã¤ã¾ãŒåˆã‚ãªã„ã“ã¨ã€‚" },
            { s: "ã‚‚ã£ã¨ã€Œã‚°ã‚¿ã‚¤ã€çš„ãªä¾‹ã‚’ã‚ã’ã¦èª¬æ˜ã—ã¦ãã ã•ã„ã€‚", h: "å½¢ãŒã‚ã£ã¦ã‚ã‹ã‚Šã‚„ã™ã„ã“ã¨ã€‚", a: "å…·ä½“", c: ["å…·ä½“", "å…·å¯¾", "ä¾›ä½“", "å…·å¸¯"], ex: "ã¯ã£ãã‚Šã¨ã—ãŸå½¢ãŒã‚ã‚‹ã“ã¨ã€‚" },
            { s: "ã¼ãã®ã€Œã‚·ãƒ¥ã‚«ãƒ³ã€ã ã‘ã©ã€ã“ã‚ŒãŒä¸€ç•ªãŠã„ã—ã„ï¼", h: "è‡ªåˆ†ã ã‘ã®æ„Ÿã˜æ–¹ã€‚", a: "ä¸»è¦³", c: ["ä¸»è¦³", "ä¸»æ„Ÿ", "ç¨®è¦³", "å®ˆè¦³"], ex: "è‡ªåˆ†ã²ã¨ã‚Šã®è¦‹æ–¹ã€‚" },
            { s: "ã¿ã‚“ãªã®æ„è¦‹ã‚’èã„ã¦ã€Œã‚­ãƒ£ãƒƒã‚«ãƒ³ã€çš„ã«ã¿ã‚ˆã†ã€‚", h: "ã ã‚ŒãŒè¦‹ã¦ã‚‚æ­£ã—ã„ç«‹å ´ã§ã¿ã‚‹ã“ã¨ã€‚", a: "å®¢è¦³", c: ["å®¢è¦³", "å„è¦³", "å®¢å®¶", "å®¢é–¢"], ex: "è‡ªåˆ†ã‚’ã¯ãªã‚Œã¦å†·é™ã«è¦‹ã‚‹ã“ã¨ã€‚" }
        ],
        [
            { s: "ã€Œå¹³å’Œã€ã¨ã„ã†ã€Œã‚¬ã‚¤ãƒãƒ³ã€ã‚’è€ƒãˆã‚‹ã€‚", h: "é ­ã®ä¸­ã«ã‚ã‚‹å…±é€šã®è€ƒãˆã€‚", a: "æ¦‚å¿µ", c: ["æ¦‚å¿µ", "å¤–å¿µ", "æ…¨å¿µ", "è©²å¿µ"], ex: "ç‰©äº‹ã®å…±é€šã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã€‚" },
            { s: "æŠœãå‡ºã—ã¦ã€Œãƒãƒ¥ã‚¦ã‚·ãƒ§ã‚¦ã€çš„ã«è€ƒãˆã‚‹ã€‚", h: "å¤§äº‹ãªç‚¹ã ã‘ã‚’è¦‹ã‚‹ã“ã¨ã€‚", a: "æŠ½è±¡", c: ["æŠ½è±¡", "æŠ½å‡º", "å®™è±¡", "æ³¨è±¡"], ex: "å…±é€šã®æ€§è³ªã‚’ã¬ãå‡ºã™ã“ã¨ã€‚" },
            { s: "ã€Œã‚®ãƒ£ã‚¯ã‚»ãƒ„ã€ã ã‘ã©ã€æ€¥ãŒã°å›ã‚Œã€‚", h: "åå¯¾ã«è¦‹ãˆã¦å®Ÿã¯æ­£ã—ã„ã“ã¨ã€‚", a: "é€†èª¬", c: ["é€†èª¬", "é€†æ¥", "è™èª¬", "é€†æ‘‚"], ex: "ä¸€è¦‹ã‚¦ã‚½ã®ã‚ˆã†ã§çœŸå®Ÿã®ã“ã¨ã€‚" },
            { s: "ã‚´ãƒŸã‚’è³‡æºã«ã€Œã‚«ãƒ³ã‚²ãƒ³ã€ã™ã‚‹ã€‚", h: "å…ƒã®çŠ¶æ…‹ã«ã‚‚ã©ã—ã¦è¿”ã™ã“ã¨ã€‚", a: "é‚„å…ƒ", c: ["é‚„å…ƒ", "ç”˜è¨€", "å®Œé™", "æ„Ÿè¨€"], ex: "ã‚‚ã¨ã®å½¢ã‚„å ´æ‰€ã«ã‚‚ã©ã™ã“ã¨ã€‚" },
            { s: "ç†æƒ³ã¨ç¾å®Ÿã®é–“ã«å¤§ããªã€Œã‚«ã‚¤ãƒªã€ãŒã‚ã‚‹ã€‚", h: "é›¢ã‚Œã¦ã—ã¾ã†ã“ã¨ã€‚", a: "ä¹–é›¢", c: ["ä¹–é›¢", "ä¹–ç†", "é–‹é›¢", "æ”¹é›¢"], ex: "ãã‚€ãã€ã¯ãªã‚Œã‚‹ã“ã¨ã€‚" }
        ],
        [
            { s: "è‡ªåˆ†ã®æ„è¦‹ã‚’ã€Œã‚­ãƒ§ã‚¦ãƒ¡ã‚¤ã€ã—ã¦ãã‚Œã‚‹ã€‚", h: "ä»–äººã®è€ƒãˆã«å¿ƒã‹ã‚‰è³›æˆã™ã‚‹ã“ã¨ã€‚", a: "å…±é³´", c: ["å…±é³´", "éŸ¿é³´", "ä»Šæ—¥å", "å…±å‘½"], ex: "åŒã˜æ°—æŒã¡ã§å¿ƒãŒå‹•ãã“ã¨ã€‚" },
            { s: "æ–‡åŒ–ã®ã€Œã‚¿ãƒ¨ã‚¦ã€æ€§ã‚’å°Šé‡ã™ã‚‹ã€‚", h: "ã„ã‚ã„ã‚ãªç¨®é¡ãŒã‚ã‚‹ã“ã¨ã€‚", a: "å¤šæ§˜", c: ["å¤šæ§˜", "å¤šç”¨", "å¤šè‘‰", "å¤§æ§˜"], ex: "ã„ã‚ã„ã‚ãªç¨®é¡ãŒã‚ã‚‹ã“ã¨ã€‚" },
            { s: "æ–°ã—ã„æŠ€è¡“ãŒç¤¾ä¼šã‚’ã€Œãƒ˜ãƒ³ãƒœã‚¦ã€ã•ã›ã‚‹ã€‚", h: "å§¿ã‚„ã™ã£ã‹ã‚Šå¤‰ã‚ã‚‹ã“ã¨ã€‚", a: "å¤‰è²Œ", c: ["å¤‰è²Œ", "å¤‰é˜²", "ç·¨æŸ", "å¤‰æœ›"], ex: "å§¿ã‚„æ§˜å­ãŒã‚¬ãƒ©ãƒªã¨å¤‰ã‚ã‚‹ã“ã¨ã€‚" },
            { s: "å¤ã„è€ƒãˆæ–¹ã‚’ã€Œãƒ€ãƒã€ã™ã‚‹ã€‚", h: "æ‚ªã„çŠ¶æ…‹ã‚’æ‰“ã¡ç ´ã‚‹ã“ã¨ã€‚", a: "æ‰“ç ´", c: ["æ‰“ç ´", "æ‰“æ³¢", "è›‡æ³¢", "é§„æ´¾"], ex: "æ‰“ã¡ç ´ã‚‹ã“ã¨ã€‚" },
            { s: "è¨€è‘‰ã‚’ã€Œã‚³ã‚¦ãƒŸãƒ§ã‚¦ã€ã«æ“ã‚‹ã€‚", h: "ã‚„ã‚Šæ–¹ãŒéå¸¸ã«ã†ã¾ã„ã“ã¨ã€‚", a: "å·§å¦™", c: ["å·§å¦™", "å…¬æ˜", "å¥½å¦™", "åŠŸå"], ex: "ãŸãã¿ã§ä¸Šæ‰‹ãªã“ã¨ã€‚" }
        ]
    ];

    let currentSet, currentQ, score, timer, timeLeft;
    const bgm = document.getElementById('bgm');
    const bgmBtn = document.getElementById('bgm-btn');
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function toggleBGM() {
        if (bgm.paused) { bgm.play(); bgmBtn.innerText = "ğŸµ BGM: ON"; }
        else { bgm.pause(); bgmBtn.innerText = "ğŸ”‡ BGM: OFF"; }
    }

    function startQuiz(idx) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const randomFile = musicFiles[Math.floor(Math.random() * musicFiles.length)];
        bgm.src = randomFile;
        bgm.play().catch(() => {});
        document.getElementById('menu').style.display = 'none';
        document.getElementById('quiz').style.display = 'flex';
        currentSet = idx; currentQ = 0; score = 0;
        showQuestion();
    }

    function showQuestion() {
        const q = QUIZ_DATA[currentSet][currentQ];
        document.getElementById('q-count').innerText = `${currentQ + 1} / 5`;
        const mText = document.getElementById('meaning-text');
        mText.innerText = q.h; mText.classList.remove('visible-text');
        document.getElementById('question-text').innerText = q.s.replace(q.a, 'ï¼ˆã€€ã€€ï¼‰');
        const choices = document.getElementById('choices');
        choices.innerHTML = "";
        [...q.c].sort(() => Math.random() - 0.5).forEach(c => {
            const b = document.createElement('button');
            b.className = "choice-btn";
            b.innerText = c; b.onclick = () => checkAnswer(c); choices.appendChild(b);
        });
        startTimer();
    }

    function revealMeaning() { document.getElementById('meaning-text').classList.add('visible-text'); }

    function startTimer() {
        timeLeft = 20;
        const bar = document.getElementById('timer-bar');
        const hand = document.getElementById('clock-hand');
        const digital = document.getElementById('digital-timer');
        clearInterval(timer);
        timer = setInterval(() => {
            timeLeft -= 0.1; if (timeLeft < 0) timeLeft = 0;
            bar.style.width = (timeLeft / 20) * 100 + "%";
            digital.innerText = timeLeft.toFixed(1);
            hand.style.transform = `rotate(${((20 - timeLeft) / 20) * 360}deg)`;
            if (timeLeft <= 0) { clearInterval(timer); checkAnswer("TIME_UP"); }
        }, 100);
    }

    function checkAnswer(choice) {
        clearInterval(timer);
        const q = QUIZ_DATA[currentSet][currentQ];
        const overlay = document.getElementById('feedback-overlay');
        const icon = document.getElementById('feedback-icon');
        document.getElementById('correct-ans').innerText = q.a;
        document.getElementById('exp-text').innerText = q.ex;
        if (choice === q.a) { score++; playS('ok'); icon.innerText = "â­•ï¸"; icon.style.color = "#ff4d4d"; }
        else { playS('ng'); icon.innerText = choice === "TIME_UP" ? "â°" : "âŒ"; icon.style.color = "#4d94ff"; }
        overlay.classList.remove('hidden');
    }

    function nextQuestion() {
        document.getElementById('feedback-overlay').classList.add('hidden');
        currentQ++; if (currentQ < 5) showQuestion(); else showResult();
    }

    function playS(type) {
        const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
        o.connect(g); g.connect(audioCtx.destination);
        if(type === 'ok') { o.frequency.setValueAtTime(880, audioCtx.currentTime); o.frequency.exponentialRampToValueAtTime(1760, audioCtx.currentTime + 0.1); }
        else { o.type = 'triangle'; o.frequency.setValueAtTime(200, audioCtx.currentTime); }
        g.gain.setValueAtTime(0.1, audioCtx.currentTime); g.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.2);
        o.start(); o.stop(audioCtx.currentTime + 0.2);
    }

    function showResult() {
        document.getElementById('quiz').style.display = 'none';
        const res = document.getElementById('result');
        res.classList.remove('hidden');
        document.getElementById('result-title').innerText = `${score}ç‚¹ï¼`;
    }
</script>
</body>
</html>